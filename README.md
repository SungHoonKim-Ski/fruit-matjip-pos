# 과일맛집 프린터 브릿지

배달 주문 결제 완료 시 영수증을 자동 출력하는 로컬 서버입니다.
매장 PC에서 실행하며, USB로 연결된 영수증 프린터로 출력합니다.

```
관리자 브라우저 (https://fruit-matjip.store/admin)
    ↓ fetch('http://127.0.0.1:18181/print')
프린터 브릿지 서버 (매장 PC에서 실행 중)
    ↓ ESC/POS 명령
USB 영수증 프린터
```

---

## 매장 PC 설치 가이드 (Windows)

### 방법 A: 실행 파일 (.exe) 사용 — 권장

Java의 JAR처럼, Node.js 설치 없이 `.exe` 파일 하나로 실행합니다.

#### 1. 실행 파일 받기

개발자가 빌드한 `onuljang-printer.exe` 파일을 매장 PC에 복사합니다.
- 예: `C:\onuljang-printer\onuljang-printer.exe`

#### 2. USB 프린터 연결

1. 영수증 프린터를 USB 케이블로 매장 PC에 연결
2. 프린터 전원 ON
3. 프린터 제조사 드라이버가 필요한 경우, 제조사 홈페이지에서 드라이버 설치

#### 3. 실행

`onuljang-printer.exe`를 더블클릭합니다.

아래 메시지가 나오면 정상 실행 완료:
```
🖨️  프린터 브릿지 서버 시작
   포트: 18181
✅ 프린터 연결 확인됨
```

**이 창을 닫지 마세요** — 창을 닫으면 서버가 종료됩니다.

#### 4. PC 부팅 시 자동 실행 설정 (선택)

1. `Win + R` → `shell:startup` 입력 → Enter
2. 열린 폴더에 `onuljang-printer.exe`의 바로가기를 복사
3. 이후 PC를 켤 때마다 자동으로 프린터 서버가 실행됩니다

---

### 방법 B: Node.js 직접 설치 후 실행

#### 1. Node.js 설치

1. https://nodejs.org/ko 접속 → **LTS 버전** 다운로드 → 설치
2. 설치 중 나오는 옵션은 전부 **"Next"** 클릭 (기본값 유지)
3. 설치 완료 확인: 시작 메뉴에서 **"명령 프롬프트"** 열고 아래 입력
   ```
   node -v
   ```
   `v22.x.x` 같은 버전 번호가 나오면 성공

#### 2. 프린터 브릿지 파일 복사

`onuljang-printer` 폴더 전체를 매장 PC의 원하는 위치에 복사합니다.
- 예: `C:\onuljang-printer`

#### 3. 의존성 설치

**명령 프롬프트**를 열고 아래 입력:
```
cd C:\onuljang-printer
npm install
```

설치 완료까지 약 10~30초 대기합니다.

#### 4. USB 프린터 연결

1. 영수증 프린터를 USB 케이블로 매장 PC에 연결
2. 프린터 전원 ON
3. 프린터 제조사 드라이버가 필요한 경우, 제조사 홈페이지에서 드라이버 설치

#### 5. 서버 실행

**명령 프롬프트**에서 아래 입력:
```
cd C:\onuljang-printer
npm start
```

아래 메시지가 나오면 정상 실행 완료:
```
🖨️  프린터 브릿지 서버 시작
   포트: 18181
✅ 프린터 연결 확인됨
```

**이 창을 닫지 마세요** — 창을 닫으면 서버가 종료됩니다.

#### 6. PC 부팅 시 자동 실행 설정 (선택)

1. 메모장을 열고 아래 내용 입력
   ```
   cd C:\onuljang-printer
   npm start
   ```
2. **"파일 > 다른 이름으로 저장"** 클릭
3. 파일 이름: `프린터서버.bat`, 파일 형식: **"모든 파일"** 선택 후 바탕화면에 저장
4. `Win + R` → `shell:startup` 입력 → Enter
5. 열린 폴더에 바탕화면의 `프린터서버.bat` 파일을 복사
6. 이후 PC를 켤 때마다 자동으로 프린터 서버가 실행됩니다

---

## 동작 확인

1. 매장 PC 브라우저에서 관리자 페이지 접속 (`https://fruit-matjip.store/admin`)
2. 배달 주문 목록에서 **"출력"** 버튼 클릭
3. 영수증이 출력되면 성공

---

## 문제 해결

| 증상 | 해결 방법 |
|------|-----------|
| "프린터 연결 안 됨" 메시지 | USB 케이블 재연결, 프린터 전원 확인 |
| "출력" 버튼 눌러도 반응 없음 | 명령 프롬프트 또는 .exe 창에서 서버가 실행 중인지 확인 |
| 한글이 깨져서 출력됨 | 프린터가 한글 코드페이지 미지원 — 별도 문의 필요 |
| Windows 방화벽 경고 | "액세스 허용" 클릭 (로컬 통신이므로 보안 문제 없음) |

---

## 개발자용: .exe 빌드 방법

매장에 배포할 실행 파일을 빌드하는 방법입니다.

```bash
cd onuljang-printer

# 의존성 설치 (devDependencies 포함)
npm install

# .exe 빌드 (dist/onuljang-printer.exe 생성)
npm run package
```

빌드 과정:
1. `esbuild`가 소스 코드와 모든 의존성을 단일 JS 파일(`dist/bundle.cjs`)로 번들링
2. `pkg`가 Node.js 런타임을 포함한 Windows 실행 파일(`dist/onuljang-printer.exe`)로 패키징

생성된 `dist/onuljang-printer.exe`를 매장 PC에 복사하면 됩니다.
